// Copyright (c) 2016, Open DICOMweb Project. All rights reserved.
// Use of this source code is governed by the open source license
// that can be found in the LICENSE file.
// Author: Jim Philbin <jfphilbin@gmail.edu> -
// See the AUTHORS file for other contributors.

import 'dart:typed_data';

import 'package:core/src/element/base/element.dart';
import 'package:core/src/element/base/string.dart';
import 'package:core/src/issues.dart';
import 'package:core/src/logger/formatter.dart';
import 'package:core/src/tag/export.dart';

// Note: PrivateData Elements are just regular [Element]s
abstract class PrivateElementMixin<V> {
  Element<V> get e;
  bool get wasUN;

  int get sgIndex => tag.subGroup;

  PrivateTag get tag => e.tag;

  @override
  bool operator ==(Object other) => other is PrivateElementMixin && e ==
                                                                    other.e;

  @override
  List<V> get emptyList => e.emptyList;
  @override
  int get hashCode => e.hashCode;

  bool get isKnown => tag.isKnown;
  @override
  int get group => e.tag.group;
  //Why are these 3 necessary
  @override
  int get code => tag.code;
  @override
  String get keyword => tag.keyword;
  @override
  int get vrIndex => tag.vrIndex;
  @override
  int get vrCode => tag.vrCode;
  @override
  VM get vm => tag.vm;
  @override
  int get sizeInBytes => tag.elementSize;

  int get vfLengthField => e.vfLengthField;
  @override
  Iterable<V> get values => e.values;

  @override
  bool get isPrivate => true;

  @override
  int get padChar => e.padChar;

  @override
  Element get sha256 => e.sha256;

  @override
  TypedData get typedData => e.typedData;

  @override
  Uint8List get vfBytes => e.vfBytes;


  ByteData get vfByteData => e.vfByteData;

  int get deIdIndex => e.deIdIndex;
  int get ieIndex => e.ieIndex;
  bool checkValues(Iterable<V> vList, [Issues issues]) =>
      e.checkValues(vList, issues);

  PrivateElementMixin<V> view([int start = 0, int end]) =>
      throw new UnimplementedError();
}

class PrivateCreator extends LO with PrivateElementMixin<String> {
  @override
  final PCTag tag;
  @override
  final Element<String> e;
  @override
  final bool wasUN;

  PrivateCreator(this.tag, this.e, {this.wasUN});

  @override
  List<String> get values => e.values;
  @override
  set values(Iterable<String> vList) => e.values = vList;

  int get base => tag.base;
  int get limit => tag.limit;
  String get token => e.value;

  @override
  PrivateCreator update([Iterable<String> vList]) => e.update(vList);

  bool inSubgroup(int pdCode) => (tag.elt >= base) && (tag.elt <= limit);



  @override
  String toString() => '$runtimeType${tag.dcm} ${tag.name}';
}


